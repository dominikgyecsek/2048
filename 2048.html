<!DOCTYPE html>
<html>
<head>
	<title>2048</title>
	<link href='https://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>

	<style>

	body {
		font-size: 30px;
		text-align: center;
		font-family: 'Droid Sans';
	}

	#game {
		background-color: red;
		width: 500px;
		height: 500px;
		margin: 0 auto;
	}

	.tile {
		width: 100px;
		height: 100px;
		background-color: rgb(215, 215, 215);
		float: left;
		line-height: 100px;
	}

	.color-2 { background-color: #69D2E7; color: #FA6900; }
	.color-4 { background-color: #FA6900; color: #69D2E7; }
	.color-8 { background-color: #ECD078; color: #C02942; }
	.color-16 { background-color: #C02942; color: #ECD078; }
	.color-32 { background-color: #A8DBA8; color: #3B8686; }
	.color-64 { background-color: #3B8686; color: #A8DBA8; }
	.color-128 { background-color: #774F38; color: #F1D4AF; }
	.color-256 { background-color: #F1D4AF; color: #774F38; }
	.color-512 { background-color: #547980; color: #E5FCC2; }
	.color-1024 { background-color: #E5FCC2; color: #547980; }
	.color-2048 { background-color: #00A0B0; color: #6A4A3C; }
	.color-4096 { background-color: #6A4A3C; color: #00A0B0; }
	.color-8192 { background-color: #E94E77; color: #C6E5D9; }
	.color-16384 { background-color: #C6E5D9; color: #E94E77; }
	.color-32768 { background-color: #FFFFFF; color: #1C140D; }
	.color-65536 { background-color: #1C140D; color: #FFFFFF; }
	.color-131072 { background-color: #73626E; color: #F7E4BE; font-size: 25px; }
	.color-262144 { background-color: #F7E4BE; color: #73626E; font-size: 25px; }
	.color-524288 { background-color: #005F6B; color: #00DFFC; font-size: 25px; }
	.color-1048576 { background-color: #00DFFC; color: #005F6B; font-size: 23px; }
	.color-2097152 { background-color: #645543; color: #BF4D28; font-size: 23px; }
	.color-4194304 { background-color: #BF4D28; color: #645543; font-size: 23px; }
	.color-8388608 { background-color: #8FBE00; color: #00A8C6; font-size: 23px; }
	.color-16777216 { background-color: #00A8C6; color: #8FBE00; font-size: 21px; }
	.color-33554432 { background-color: #FF9900; color: #424242; font-size: 21px; }

	</style>
</head>
<body>

<div id="game">
	<div class="tile" id="1"></div>
	<div class="tile" id="2"></div>
	<div class="tile" id="3"></div>
	<div class="tile" id="4"></div>
	<div class="tile" id="5"></div>
	<div class="tile" id="6"></div>
	<div class="tile" id="7"></div>
	<div class="tile" id="8"></div>
	<div class="tile" id="9"></div>
	<div class="tile" id="10"></div>
	<div class="tile" id="11"></div>
	<div class="tile" id="12"></div>
	<div class="tile" id="13"></div>
	<div class="tile" id="14"></div>
	<div class="tile" id="15"></div>
	<div class="tile" id="16"></div>
	<div class="tile" id="17"></div>
	<div class="tile" id="18"></div>
	<div class="tile" id="19"></div>
	<div class="tile" id="20"></div>
	<div class="tile" id="21"></div>
	<div class="tile" id="22"></div>
	<div class="tile" id="23"></div>
	<div class="tile" id="24"></div>
	<div class="tile" id="25"></div>
</div>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

<script>

	var gameOver = false;
	var foundSpace = false;
	var random;
	var direction;
	var isValidMove;

	/*var table = [ null,
		2, 4, 8, 16, 32,
		64, 128, 256, 512, 1024,
		2048, 4096, 8192, 16384, 32768,
		65536, 131072, 262144, 524288, 1048576,
		2097152, 4194304, 8388608, 16777216, 33554432
	]*/

	var table = [null,
		0,0,0,0,0,
		0,0,0,0,0,
		0,0,0,0,0,
		0,0,0,0,0,
		0,0,0,0,0
	];

	initialize();

	function initialize() {
		console.log("INIT");
		generateTile();
		drawTiles();
	}

	function drawTiles() {

		for (var i = 2; i < 256; i *= 2) {
			$(".color-" + i).removeClass("color-" + i);
		}

		for (var i = 1; i < table.length; i++) {

			var value = table[i];
			if (value == 0) value = "";
			$("#" + i).text(value).addClass("color-" + value);
		}

	}

	function shiftTiles() {

		var multi = direction[5];
		isValidMove = false;

		for (var i = 0; i < 5; i++) {

			var startIndex = direction[i]
			var indexes = [ startIndex, startIndex + multi, startIndex + multi*2, startIndex + multi*3, startIndex + multi*4 ];
			var values = [0, 0, 0, 0, 0];

			for (var j = 0; j < 5; j++) {

				var index = indexes[j];
				values[j] = table[index];

			}

			if ( !isEmpty(values) ) {

				values = shiftZeros(values);
				values = mergeTiles(values);
				values = shiftZeros(values);
				
				for (var j = 0; j < 5; j++) {

					var index = indexes[j];
					table[index] = values[j];

				}

			}

		}

		return isValidMove;

	}

	function shiftZeros(values) {

		var valuesOld = JSON.parse(JSON.stringify(values));

		for (var i = 0; i < 5; i++) {

			if ( values[i] == 0 ) {
				values.splice(i, 1);
				i--;
			}

		}

		while ( values.length != 5 ) {
			values.push(0);
		}

		if ( !isSameArray(valuesOld, values) ) isValidMove = true;

		return values;

	}

	function isSameArray(arr1, arr2) {

		if ( arr1.length != arr2.length ) return false;
		for (var i = 0; i < arr1.length; i++) if (arr1[i] != arr2[i]) return false;
		return true;

	}

	function mergeTiles(values) {

		for (var i = 0; i < 4; i++) {

			if ( values[i] == values[i+1] ) {
				values[i] = values[i] * 2;
				values[i+1] = 0;
			}

		}

		return values;

	}

	function isEmpty (arr) {

		if ( arr.join("") == "00000" )
			return true;
		return false;

	}

	function generateTile() {

		if ( table.indexOf(0) == -1 ) {
			gameOver = true;
			
		}

		foundSpace = false;

		while (!foundSpace) {
			random = getRandomInt(1, 25);
			if ( table[random] == 0 ) {
				table[random] = 2;
				foundSpace = true;
			}	
		}

		foundSpace = false;

	}

	$("html").keydown(function(e){

		if(!gameOver) {

			switch (e.keyCode) {

				case 65: direction = [1,6,11,16,21,1]; break;
				case 83: direction = [21,22,23,24,25,-5]; break;
				case 68: direction = [5,10,15,20,25,-1]; break;
				case 87: direction = [1,2,3,4,5, 5]; break;
				default: return;

			}

			if ( !shiftTiles() ) return;

			drawTiles();

			generateTile();

			drawTiles();

		} else {

			alert("game over");

		}

	});

	function getRandomInt(min, max) {

    	return Math.floor(Math.random() * (max - min + 1)) + min;

	} 

	setInterval(function() {
		console.log(table);
	}, 5000);

</script>

</body>
</html>